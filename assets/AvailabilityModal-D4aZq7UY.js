import{r as d,b as H,d as W,j as e,q as z,e as S,f as j,w as J,h as Y,i as C,k as M,s as R,l as Q,n as X}from"./index-BmufIvvC.js";const T=["Lunes","Martes","MiÃ©rcoles","Jueves","Viernes","SÃ¡bado","Domingo"],Z=({isOpen:b,onClose:v,user:c,userProfile:l,addCoins:L,logEvent:D})=>{const[i,A]=d.useState("next"),[U,w]=d.useState(!1),[E,$]=d.useState([]),[n,_]=d.useState(c?.uid),f={Lunes:{hours:0,off:!1},Martes:{hours:0,off:!1},MiÃ©rcoles:{hours:0,off:!1},Jueves:{hours:0,off:!1},Viernes:{hours:0,off:!1},SÃ¡bado:{hours:0,off:!0},Domingo:{hours:0,off:!0}},[u,g]=d.useState(f),h=d.useMemo(()=>i==="next"?H():W(),[i]);d.useEffect(()=>{if(!b)return;const t=l?.role;(t==="team_leader"||t==="admin")&&(async()=>{try{const a=l?.team||"Tema 1",s=z(S(j,"users"),J("team","==",a)),p=(await Y(s)).docs.map(x=>({id:x.id,...x.data()}));$(p)}catch(a){console.error("Error buscando agentes:",a)}})()},[b,l]),d.useEffect(()=>{if(!b||!n)return;(async()=>{w(!0);try{const r=`${n}_${h}`,a=C(j,"weekly_schedules",r),s=await M(a);if(s.exists()){const N=s.data();g({...f,...N.schedule||{}})}else g(f)}catch(r){console.error(r)}w(!1)})()},[b,h,n]);const k=(t,r)=>{const a=u[t]||{hours:0,off:!1};let s=(a.hours||0)+r;s<0&&(s=0),s>24&&(s=24),g({...u,[t]:{...a,hours:s}})},O=(t,r)=>{const a=parseFloat(r);if(isNaN(a))return;let s=a;s<0&&(s=0),s>24&&(s=24),g({...u,[t]:{...u[t],hours:s}})},F=async()=>{w(!0);const t=n!==c.uid,r=n,a=t?E.find(o=>o.id===n):l,s=a?.userName||a?.email||"Agente",N=`${r}_${h}`,p=C(j,"weekly_schedules",N),x={};T.forEach(o=>{x[o]=u[o]||f[o]});try{const o=i==="current",y=await M(p),I=y.exists();if(t)await R(p,{uid:r,userName:s,team:a?.team||"default",weekId:h,schedule:x,submittedAt:Date.now(),loadedByLeader:!0,auditTrail:Q({modifiedByUid:c.uid,modifiedByName:l?.userName||c.email||"LÃ­der",timestamp:Date.now(),dateReadable:new Date().toLocaleString()})},{merge:!0}),alert(`âœ… Horario de ${s} cargado manualmente.`);else if(o||I){const V=I?y.data().schedule:f,G=o?`${s} quiere hacer cambios en la disponibilidad de esta semana!`:`${s} modificÃ³ la disponibilidad de la siguiente semana!`;await X(S(j,"schedule_requests"),{uid:r,userName:s,weekId:h,currentSchedule:V,proposedSchedule:x,status:"pending",type:o?"urgent":"planning",message:G,createdAt:Date.now()}),alert(o?"ðŸš¨ SOLICITUD URGENTE ENVIADA AL TEAM LEADER":"ðŸ“© CAMBIO ENVIADO AL TEAM LEADER"),D&&D("SCHEDULE_REQUEST_SENT")}else await R(p,{uid:r,userName:s,team:a?.team||"default",weekId:h,schedule:x,submittedAt:Date.now()},{merge:!0}),new Date().getDay()===5&&i==="next"?(L(50),alert("âœ… Guardado + 50 Coins de Bonus de Viernes")):alert("âœ… Horario guardado correctamente");v()}catch(o){console.error("Error al enviar disponibilidad:",o),alert(`Error al enviar: ${o.message}`)}finally{w(!1)}};if(!b)return null;const m=i==="current",B=m?"bg-orange-600":"bg-purple-600",q=m?"ðŸš¨ SOLICITAR CAMBIO URGENTE":"ðŸ’¾ GUARDAR PLANIFICACIÃ“N";return e.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-fadeIn",children:e.jsxs("div",{className:"bg-[#0f111a] border border-white/10 rounded-2xl w-full max-w-md shadow-2xl overflow-hidden flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"bg-slate-900 border-b border-white/10 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"ðŸ“… Mi Disponibilidad"}),e.jsx("button",{onClick:v,className:"text-slate-400 hover:text-white font-bold",children:"âœ•"})]}),(l?.role==="team_leader"||l?.role==="admin")&&e.jsxs("div",{className:"mb-4 bg-indigo-900/30 border border-indigo-500/50 rounded-lg p-2",children:[e.jsx("label",{className:"text-[10px] text-indigo-300 font-bold uppercase tracking-wider mb-1 block",children:"Cargar en nombre de:"}),e.jsxs("select",{value:n,onChange:t=>_(t.target.value),className:"w-full bg-black/50 text-white text-sm border border-white/10 rounded-md p-1.5 outline-none focus:border-indigo-500",children:[e.jsxs("option",{value:c?.uid,children:["Yo mismo (",l?.userName,")"]}),e.jsx("optgroup",{label:"Mi Equipo",children:E.map(t=>e.jsx("option",{value:t.id,children:t.userName||t.email},t.id))})]})]}),e.jsxs("div",{className:"bg-black/40 p-1 rounded-lg flex border border-white/5 relative",children:[e.jsx("button",{onClick:()=>A("current"),className:`flex-1 py-2 text-xs font-bold rounded-md transition-all ${i==="current"?"bg-orange-600 text-white shadow-lg":"text-slate-400 hover:text-white"}`,children:"ESTA SEMANA"}),e.jsx("button",{onClick:()=>A("next"),className:`flex-1 py-2 text-xs font-bold rounded-md transition-all ${i==="next"?"bg-purple-600 text-white shadow-lg":"text-slate-400 hover:text-white"}`,children:"PRÃ“XIMA SEMANA"})]}),e.jsxs("div",{className:`text-[10px] text-center mt-2 font-mono font-bold ${m?"text-orange-400":"text-green-400"}`,children:["ID: ",h]})]}),e.jsx("div",{className:"p-6 space-y-3 overflow-y-auto custom-scrollbar flex-1 bg-[#0b0e14]",children:U?e.jsx("div",{className:"text-center py-10 text-slate-500 animate-pulse",children:"Cargando horario..."}):e.jsxs(e.Fragment,{children:[new Date().getDay()===5&&i==="next"&&e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 p-3 rounded-lg text-center animate-pulse",children:e.jsx("p",{className:"text-xs text-yellow-300 font-bold",children:"âš¡ BONUS VIERNES ACTIVO"})}),m&&e.jsxs("div",{className:"bg-orange-900/20 border border-orange-500/30 p-3 rounded-lg flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:"âš ï¸"}),e.jsx("p",{className:"text-xs text-orange-200",children:"Los cambios en la semana actual requieren aprobaciÃ³n del TL."})]}),T.map(t=>{const r=u[t]||{hours:0,off:!1};return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${m?"bg-orange-900/5 border-orange-500/10":"bg-slate-800 border-white/5"}`,children:[e.jsx("span",{className:"w-20 font-bold text-sm text-slate-200 capitalize",children:t}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:`flex items-center gap-2 text-xs font-bold ${r.off?"text-red-400":"text-slate-400"} cursor-pointer select-none bg-black/20 px-2 py-1.5 rounded border border-white/5 hover:bg-white/5 transition-colors`,children:[e.jsx("input",{type:"checkbox",checked:r.off,onChange:a=>g({...u,[t]:{...r,off:a.target.checked}}),className:"accent-red-500 w-4 h-4 rounded"}),"OFF"]}),!r.off&&e.jsxs("div",{className:"flex items-center bg-black/40 rounded-lg border border-white/10 overflow-hidden",children:[e.jsx("button",{onClick:()=>k(t,-1),className:"w-8 h-8 flex items-center justify-center bg-slate-700 hover:bg-slate-600 text-white font-bold transition-colors active:bg-slate-800",children:"-"}),e.jsxs("div",{className:"w-12 h-8 flex items-center justify-center bg-transparent border-x border-white/5 relative",children:[e.jsx("input",{type:"number",value:r.hours,onChange:a=>O(t,a.target.value),className:"w-full h-full bg-transparent text-center text-white text-sm font-bold outline-none appearance-none"}),e.jsx("span",{className:"absolute right-1 bottom-1 text-[8px] text-slate-500",children:"hs"})]}),e.jsx("button",{onClick:()=>k(t,1),className:"w-8 h-8 flex items-center justify-center bg-indigo-600 hover:bg-indigo-500 text-white font-bold transition-colors active:bg-indigo-700",children:"+"})]})]})]},t)})]})}),e.jsx("div",{className:"p-4 border-t border-white/10 bg-slate-900",children:e.jsxs("button",{onClick:F,className:`w-full text-white font-bold py-3 rounded-xl shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2 ${B} hover:brightness-110`,children:[n!==c?.uid?e.jsx("span",{children:"ðŸ‘‘"}):m?e.jsx("span",{children:"ðŸ“©"}):e.jsx("span",{children:"ðŸ’¾"}),n!==c?.uid?"GUARDAR MODO DIOS":q]})})]})})};export{Z as default};
