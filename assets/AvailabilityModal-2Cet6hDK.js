import{r as b,h as F,j as e,i as k,d as m,k as S,f as L,b as U,s as _}from"./index-jQ7i3lSI.js";const O=()=>{const c=new Date,x=new Date(c.getFullYear(),0,1),o=Math.ceil(((c-x)/864e5+x.getDay()+1)/7);return`${c.getFullYear()}-W${o.toString().padStart(2,"0")}`},I=["Lunes","Martes","MiÃ©rcoles","Jueves","Viernes","SÃ¡bado","Domingo"],V=({isOpen:c,onClose:x,user:o,userProfile:p,addCoins:A,logEvent:w})=>{const[l,N]=b.useState("next"),[E,j]=b.useState(!1),h={Lunes:{hours:0,off:!1},Martes:{hours:0,off:!1},MiÃ©rcoles:{hours:0,off:!1},Jueves:{hours:0,off:!1},Viernes:{hours:0,off:!1},SÃ¡bado:{hours:0,off:!0},Domingo:{hours:0,off:!0}},[i,f]=b.useState(h),d=b.useMemo(()=>l==="next"?F():O(),[l]);b.useEffect(()=>{if(!c)return;(async()=>{j(!0);try{const a=`${o.uid}_${d}`,n=k(m,"weekly_schedules",a),t=await S(n);if(t.exists()){const r=t.data();f({...h,...r.schedule||{}})}else f(h)}catch(a){console.error(a)}j(!1)})()},[c,d,o.uid]);const v=(s,a)=>{const n=i[s]||{hours:0,off:!1};let t=(n.hours||0)+a;t<0&&(t=0),t>24&&(t=24),f({...i,[s]:{...n,hours:t}})},y=(s,a)=>{const n=parseFloat(a);if(isNaN(n))return;let t=n;t<0&&(t=0),t>24&&(t=24),f({...i,[s]:{...i[s],hours:t}})},C=async()=>{const s=`${o.uid}_${d}`,a=k(m,"weekly_schedules",s),n={};I.forEach(r=>{n[r]=i[r]||h[r]});const t=p?.name||o.email||"Agente";try{const r=await S(a),D=r.exists(),g=l==="current";if(g||D){const $=D?r.data().schedule:h,T=g?`${t} quiere hacer cambios en la disponibilidad de esta semana!`:`${t} cargÃ³ la disponibilidad de la siguiente semana!`;await L(U(m,"schedule_requests"),{uid:o.uid,userName:t,weekId:d,currentSchedule:$,proposedSchedule:n,status:"pending",type:g?"urgent":"planning",message:T,createdAt:Date.now()}),alert(g?"ðŸš¨ SOLICITUD URGENTE ENVIADA":"ðŸ“© CAMBIO ENVIADO"),w&&w("SCHEDULE_REQUEST_SENT")}else await _(a,{uid:o.uid,userName:t,team:p?.team||"default",weekId:d,schedule:n,submittedAt:Date.now()}),new Date().getDay()===5&&l==="next"?(A(50),alert("âœ… Guardado + 50 Coins")):alert("âœ… Guardado");x()}catch(r){console.error(r),alert("Error al enviar.")}};if(!c)return null;const u=l==="current",M=u?"bg-orange-600":"bg-purple-600",R=u?"ðŸš¨ SOLICITAR CAMBIO URGENTE":"ðŸ’¾ GUARDAR PLANIFICACIÃ“N";return e.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-fadeIn",children:e.jsxs("div",{className:"bg-[#0f111a] border border-white/10 rounded-2xl w-full max-w-md shadow-2xl overflow-hidden flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"bg-slate-900 border-b border-white/10 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"ðŸ“… Mi Disponibilidad"}),e.jsx("button",{onClick:x,className:"text-slate-400 hover:text-white font-bold",children:"âœ•"})]}),e.jsxs("div",{className:"bg-black/40 p-1 rounded-lg flex border border-white/5 relative",children:[e.jsx("button",{onClick:()=>N("current"),className:`flex-1 py-2 text-xs font-bold rounded-md transition-all ${l==="current"?"bg-orange-600 text-white shadow-lg":"text-slate-400 hover:text-white"}`,children:"ESTA SEMANA"}),e.jsx("button",{onClick:()=>N("next"),className:`flex-1 py-2 text-xs font-bold rounded-md transition-all ${l==="next"?"bg-purple-600 text-white shadow-lg":"text-slate-400 hover:text-white"}`,children:"PRÃ“XIMA SEMANA"})]}),e.jsxs("div",{className:`text-[10px] text-center mt-2 font-mono font-bold ${u?"text-orange-400":"text-green-400"}`,children:["ID: ",d]})]}),e.jsx("div",{className:"p-6 space-y-3 overflow-y-auto custom-scrollbar flex-1 bg-[#0b0e14]",children:E?e.jsx("div",{className:"text-center py-10 text-slate-500 animate-pulse",children:"Cargando horario..."}):e.jsxs(e.Fragment,{children:[new Date().getDay()===5&&l==="next"&&e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 p-3 rounded-lg text-center animate-pulse",children:e.jsx("p",{className:"text-xs text-yellow-300 font-bold",children:"âš¡ BONUS VIERNES ACTIVO"})}),u&&e.jsxs("div",{className:"bg-orange-900/20 border border-orange-500/30 p-3 rounded-lg flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:"âš ï¸"}),e.jsx("p",{className:"text-xs text-orange-200",children:"Los cambios en la semana actual requieren aprobaciÃ³n del TL."})]}),I.map(s=>{const a=i[s]||{hours:0,off:!1};return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${u?"bg-orange-900/5 border-orange-500/10":"bg-slate-800 border-white/5"}`,children:[e.jsx("span",{className:"w-20 font-bold text-sm text-slate-200 capitalize",children:s}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:`flex items-center gap-2 text-xs font-bold ${a.off?"text-red-400":"text-slate-400"} cursor-pointer select-none bg-black/20 px-2 py-1.5 rounded border border-white/5 hover:bg-white/5 transition-colors`,children:[e.jsx("input",{type:"checkbox",checked:a.off,onChange:n=>f({...i,[s]:{...a,off:n.target.checked}}),className:"accent-red-500 w-4 h-4 rounded"}),"OFF"]}),!a.off&&e.jsxs("div",{className:"flex items-center bg-black/40 rounded-lg border border-white/10 overflow-hidden",children:[e.jsx("button",{onClick:()=>v(s,-1),className:"w-8 h-8 flex items-center justify-center bg-slate-700 hover:bg-slate-600 text-white font-bold transition-colors active:bg-slate-800",children:"-"}),e.jsxs("div",{className:"w-12 h-8 flex items-center justify-center bg-transparent border-x border-white/5 relative",children:[e.jsx("input",{type:"number",value:a.hours,onChange:n=>y(s,n.target.value),className:"w-full h-full bg-transparent text-center text-white text-sm font-bold outline-none appearance-none"}),e.jsx("span",{className:"absolute right-1 bottom-1 text-[8px] text-slate-500",children:"hs"})]}),e.jsx("button",{onClick:()=>v(s,1),className:"w-8 h-8 flex items-center justify-center bg-indigo-600 hover:bg-indigo-500 text-white font-bold transition-colors active:bg-indigo-700",children:"+"})]})]})]},s)})]})}),e.jsx("div",{className:"p-4 border-t border-white/10 bg-slate-900",children:e.jsxs("button",{onClick:C,className:`w-full text-white font-bold py-3 rounded-xl shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2 ${M} hover:brightness-110`,children:[u?e.jsx("span",{children:"ðŸ“©"}):e.jsx("span",{children:"ðŸ’¾"})," ",R]})})]})})};export{V as default};
